<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Graph Framework: Build System</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Graph Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('build_system.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Build System</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#build_system_introduction">Introduction</a>
  </li>
  <li class="level1">
    <a href="#build_system_user">User Guide</a>
    <ul>
      <li class="level2">
        <a href="#build_system_user_dependencies">Dependencies</a>
        <ul>
          <li class="level3">
            <a href="#build_system_user_dependencies_required">Required</a>
          </li>
          <li class="level3">
            <a href="#build_system_user_dependencies_optional">Optional</a>
          </li>
        </ul>
      </li>
      <li class="level2">
        <a href="#build_system_clone">Obtaining the code</a>
      </li>
      <li class="level2">
        <a href="#build_system_gen">Generating the build system</a>
        <ul>
          <li class="level3">
            <a href="#build_system_user_options">Build system Options</a>
          </li>
          <li class="level3">
            <a href="#build_system_trouble_shooting">Trouble Shooting.</a>
          </li>
        </ul>
      </li>
      <li class="level2">
        <a href="#build_system_build">Building the code.</a>
      </li>
      <li class="level2">
        <a href="#build_system_test">Running unit tests.</a>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#build_system_dev">Developer Guide</a>
    <ul>
      <li class="level2">
        <a href="#build_system_macros">Macro Definitions</a>
        <ul>
          <li class="level3">
            <a href="#build_system_targets">Tool targets.</a>
          </li>
          <li class="level3">
            <a href="#build_system_sanitizer">Sanatizer flags</a>
          </li>
          <li class="level3">
            <a href="#build_system_project">Register an external project</a>
          </li>
        </ul>
      </li>
      <li class="level2">
        <a href="#build_system_debug">Debugging</a>
        <ul>
          <li class="level3">
            <a href="#build_system_dev_options">Build system Options</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
</div>
<div class="textblock"><p>Overview of the Cmake based build system for the graph_framework.</p>
<h1><a class="anchor" id="build_system_introduction"></a>
Introduction</h1>
<p>This page details the <a href="http://www.cmake.org">cmake</a> based build system.</p>
<hr  />
 <h1><a class="anchor" id="build_system_user"></a>
User Guide</h1>
<p>The following section is for users of framework.</p>
<h2><a class="anchor" id="build_system_user_dependencies"></a>
Dependencies</h2>
<p>The graph_framwork requires three requires external dependencies and one optional dependency. <a href="https://llvm.org">LLVM</a> is another dependency that is used for generating CPU code. However this is automatically obtained via the build system. The graph_frame is written using the C++20 standard. The C interface using C17 and the fortran interface using Fortran 2008.</p>
<h3><a class="anchor" id="build_system_user_dependencies_required"></a>
Required</h3>
<ul>
<li><a href="http://www.cmake.org">cmake</a> version greater than 3.21.</li>
<li><a href="https://www.unidata.ucar.edu">NetCDF-C</a> library.</li>
<li><a href="https://www.python.org">Python</a> 3 environment.</li>
</ul>
<h3><a class="anchor" id="build_system_user_dependencies_optional"></a>
Optional</h3>
<ul>
<li><a href="https://www.doxygen.nl/index.html">Doxygen</a> for generating this documentation.</li>
</ul>
<h2><a class="anchor" id="build_system_clone"></a>
Obtaining the code</h2>
<p>The framework code itself be obtained from the <a href="https://github.com/ORNL-Fusion/graph_framework">graph_framework</a> Github repository. </p><div class="fragment"><div class="line">git clone https:<span class="comment">//github.com/ORNL-Fusion/graph_framework.git</span></div>
</div><!-- fragment --><p> Source will be downloaded into a <code>graph_framework</code> directory unless a different directory is explicitly used.</p>
<h2><a class="anchor" id="build_system_gen"></a>
Generating the build system</h2>
<p>After the repository is cloned, create a <code>build</code> directory in the top level source directory and change into that directory. </p><div class="fragment"><div class="line">mkdir build</div>
<div class="line">cd build</div>
</div><!-- fragment --><p> There are two ways to run cmake. From the command line the build system can generated by using the <code>cmake</code> command with options set using the the <code>-D</code> option. As an exampole. </p><div class="fragment"><div class="line">cmake -DOPTION_NAME=OPTION_VALUE ../</div>
</div><!-- fragment --><p> Where <code>../</code> points to the source directory containing the top level <code>CMakeLists.txt</code> file.</p>
<p>The recommended method is to use the interatice <code>ccmake</code> command instead. </p><div class="fragment"><div class="line">ccmake ../</div>
</div><!-- fragment --><p> Note options can still be set from the command line using the <code>-D</code> option.</p>
<h3><a class="anchor" id="build_system_user_options"></a>
Build system Options</h3>
<p>Initally, there will be no options. Along the botton, there are several command. Use the 'c' command to start the configuation process. Once configured several options will apear. During this process cmake is cloning the LLVM repository. So this step may take some time initally. Mode of the are various options for configuing LLVM and can be ignored. The important options are listed below.</p>
<a class="anchor" id="build_system_user_cmake_opts"></a>
<table class="doxtable">
<caption>Build options for users.</caption>
<tr>
<th>Option </th><th>Discrption </th></tr>
<tr>
<td><code>CMAKE_BUILD_TYPE</code> </td><td>Switch between<ul>
<li><code>Release</code></li>
<li><code>Debug</code></li>
<li><code>MinSizeRel</code></li>
<li><code>RelWithDebInfo</code> </li>
</ul>
</td></tr>
<tr>
<td><code>USE_VERBOSE</code> </td><td>Show verbose information about compute kernels. </td></tr>
<tr>
<td><code>BUILD_C_BINDING</code> </td><td>Generate the C langauge interface. </td></tr>
<tr>
<td><code>BUILD_Fortran_BINDING</code></td><td>Generate the Fortran language interface. </td></tr>
<tr>
<td><code>USE_METAL</code> </td><td>Enable the <a href="https://developer.apple.com/metal/">Metal</a> backend (macOS only). </td></tr>
<tr>
<td><code>USE_CUDA</code> </td><td>Enable the <a href="https://developer.nvidia.com/cuda-zone">Cuda</a> backend (Linux only). </td></tr>
<tr>
<td><code>USE_HIP</code> </td><td>Enable the <a href="https://www.amd.com/en/products/software/rocm.html">Hip</a> backend (Linux only, Hip branch). </td></tr>
<tr>
<td><code>USE_SSH</code> </td><td>Use ssh for git instead of html. </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>macOS uses will need to change the default option for <code>CMAKE_CXX_COMPILER</code> to <code>clang++</code>. This is due to the way the build systems determines default include directories for system libraries. This can be accomplished using the advacned options using the <code>t</code> command or setting this via the command line. <div class="fragment"><div class="line">cmake -DCMAKE_CXX_COMPILER=clang++ ../</div>
</div><!-- fragment --></dd></dl>
<p>Every time an option is changed, or a new option is available, you need to use the configure <code>c</code> command for changes to take affect. Once all options are set, the a generate <code>g</code> options will appear. Using this option will build a make file.</p>
<h3><a class="anchor" id="build_system_trouble_shooting"></a>
Trouble Shooting.</h3>
<p>Some times, cmake will fail to locate the NetCDF library if it is not installed in a standard path. In these cases you can use the <code>CMAKE_PREFIX_PATH</code> to define the install location of the NetCDF library. For instance if the netcdf library is installed in <code>/foo/bar/lib</code> the prefix path should be set to <code>/foo/bar</code>.</p>
<h2><a class="anchor" id="build_system_build"></a>
Building the code.</h2>
<p>Once the build system is successfully generated a Makefile will appear. The code can be build using the </p><div class="fragment"><div class="line">make</div>
</div><!-- fragment --><p> command. Note that due build system first starts by pulling the latest of LLVM. The build system then has to build LLVM first which can take a while. It is recommended to use a limited parallel build. </p><div class="fragment"><div class="line">make -j10</div>
</div><!-- fragment --><p> The <code>-j<em>num_processes</em></code> option determines number of parallel instances to run. The build products will be found in assocated build directories in the <code>build</code> directory.</p>
<p>A list of individual components which can be build can be identified using </p><div class="fragment"><div class="line">make -h</div>
</div><!-- fragment --><h2><a class="anchor" id="build_system_test"></a>
Running unit tests.</h2>
<p>Units tests can be run using the command. </p><div class="fragment"><div class="line">make test ARGS=-j10</div>
</div><!-- fragment --><p> Like the parallel build the <code>-j<em>num_processes</em></code> option determines number of parallel instances to run.</p>
<hr  />
 <h1><a class="anchor" id="build_system_dev"></a>
Developer Guide</h1>
<p>This section covers information for developers of the framework itself.</p>
<h2><a class="anchor" id="build_system_macros"></a>
Macro Definitions</h2>
<p>The build system defines some macros for defining targets, configuring debug options, and configuing external dependences.</p>
<h3><a class="anchor" id="build_system_targets"></a>
Tool targets.</h3>
<hr  />
<p> <code>add_tool_target(target lang)</code><br  />
<br  />
 Define a tool target.<br  />
<br  />
 <b>Parameters</b><br  />
 <code>[in] <b>target</b></code> The name of the target.<br  />
 <code>[in] <b>lang</b></code> File extention for the target (c, cpp, f90).<br  />
<br  />
 Target assumes there is a source file defined as <code>target.lang</code>. For instance a C++ source file named <code>foo.cpp</code> is configures as </p><div class="fragment"><div class="line">add_tool_target(foo cpp)</div>
</div><!-- fragment --><p> This will generate a build target called <code>xfoo</code>.</p>
<hr  />
<p> <code>add_test_target(target lang)</code><br  />
<br  />
 Define a test target.<br  />
<br  />
 <b>Parameters</b><br  />
 <code>[in] <b>target</b></code> The name of the target.<br  />
 <code>[in] <b>lang</b></code> File extention for the target (c, cpp, f90).<br  />
<br  />
 The aguments are the same as <code>add_tool_target</code>. This also adds the target as a unit test. </p><hr  />
<h3><a class="anchor" id="build_system_sanitizer"></a>
Sanatizer flags</h3>
<hr  />
<p> <code>register_sanitizer_option(name)</code><br  />
<br  />
 Register a sanitizer option.<br  />
<br  />
 <b>Parameters</b><br  />
 <code>[in] <b>name</b></code> The name of the sanitizer flags.<br  />
<br  />
 This add new for using the <code>SANITIZE_<em>NAME</em></code> cmake option and add <code>-fsanitize=<em>name</em></code> to the command line arguments. </p><hr  />
<h3><a class="anchor" id="build_system_project"></a>
Register an external project</h3>
<hr  />
<p> <code>register_project(reg_name dir url default_tag sub_dir)</code><br  />
<br  />
 Register an external project.<br  />
<br  />
 <b>Parameters</b><br  />
 <code>[in] <b>reg_name</b></code> Name for the registered project.<br  />
 <code>[in] <b>dir</b></code> Name directory to clone the project to.<br  />
 <code>[in] <b>url</b></code> URL for the repository.<br  />
 <code>[in] <b>default_tag</b></code> Default tag for to pull from.<br  />
 <code>[in] <b>sub_dir</b></code> Subdirectory to locate the project source code.<br  />
<br  />
 This function clones a external project into the directory defined by <code>dir</code>. This also adds a new build option for <code>BUILD_TAG_<em>DIR</em></code>. The URL must have the format of </p><div class="fragment"><div class="line">${URL_PROTO}domain.com${URL_SEP}remining/url</div>
</div><!-- fragment --> <hr  />
<h2><a class="anchor" id="build_system_debug"></a>
Debugging</h2>
<p>In addition to the standard build options there are several debugging options that can be enabled.</p>
<h3><a class="anchor" id="build_system_dev_options"></a>
Build system Options</h3>
<a class="anchor" id="build_system_user_cmake_dev_opts"></a>
<table class="doxtable">
<caption>Build options for developers.</caption>
<tr>
<th>Option </th><th>Discrption </th></tr>
<tr>
<td><code>USE_PCH</code> </td><td>Use precomiled headers during computation. Most users should keep this on. </td></tr>
<tr>
<td><code>SAVE_KERNEL_SOURCE</code> </td><td>Option to dump the generated compute kernel source code to disk. </td></tr>
<tr>
<td><code>USE_INPUT_CACHE</code> </td><td>Option to cache registers for the kernel arguments. </td></tr>
<tr>
<td><code>USE_CONSTANT_CACHE</code> </td><td>Option to use registers to cache constant values otherwise constanst are inlined. </td></tr>
<tr>
<td><code>SHOW_USE_COUNT</code> </td><td>Generates information on the number of times a register is used. </td></tr>
<tr>
<td><code>USE_INDEX_CACHE</code> </td><td>Option to use registers to cache array indicies. </td></tr>
<tr>
<th colspan="2">Sanitizer Flags </th></tr>
<tr>
<td><code>SANITIZE_ADDRESS</code> </td><td>Use address sanitizer debugging option. </td></tr>
<tr>
<td><code>SANITIZE_LEAK</code> </td><td>Use leak sanitizer debugging option. </td></tr>
<tr>
<td><code>SANITIZE_MEMORY</code> </td><td>Use memory sanitizer debugging option. </td></tr>
<tr>
<td><code>SANITIZE_THREAD</code> </td><td>Use thread sanitizer debugging option. </td></tr>
<tr>
<td><code>SANITIZE_UNDEFINED</code> </td><td>Use undefined sanitizer debugging option. </td></tr>
<tr>
<td><code>SANITIZE_FLOAT-DIVIDE-BY-ZERO</code></td><td>Use float-divide-by-zero sanitizer debugging option. </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
