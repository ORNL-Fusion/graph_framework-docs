<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Graph Framework: Use Cases</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Graph Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('use_cases.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Use Cases</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#use_cases_introduction">Introduction</a><ul><li class="level2"><a href="#use_cases_rf">RF Ray tracing</a><ul><li class="level3"><a href="#use_cases_rf_correctness">Correctness</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#use_cases_particle_pushing">Particle Pushing</a></li>
</ul>
</div>
<div class="textblock"><p>Examples of physics problems created with the graph_framework.</p>
<h1><a class="anchor" id="use_cases_introduction"></a>
Introduction</h1>
<p>There are many problems in fusion energy where the same equation needs to be applied to a large ensemble. This paper will highlight two examples using the graph framework. The first is an RF ray tracing problem to determine plasma heating. The second example is for particle pushing.</p>
<h2><a class="anchor" id="use_cases_rf"></a>
RF Ray tracing</h2>
<p>Geometric optics is a set of asymptotic approximation methods to solve wave equations. The physics of the particular wave determines an algebraic relation between $\omega$ and $\vec{k}$ called a dispersion relation, \(D\left(\omega,\vec{k}\right)=0\). Since the parameter $t$ does not appear explicitly in the dispersion relation, the function \(\omega\left(\vec{k}\left(t\right),\vec{x}\left(t\right)\right)\) is constant along the ray trajectory </p><p class="formulaDsp">
\begin{equation}\frac{\partial\omega}{\partial t}=\frac{\partial\omega}{\partial\vec{x}}\cdot\frac{\partial\vec{x}}{\partial t}+\frac{\partial\omega}{\partial\vec{k}}\cdot\frac{\partial\vec{k}}{\partial t}\equiv 0\end{equation}
</p>
<p> by virtue of the ray equations. Since the dispersion relation is satisfied all along the ray trajectory, the derivatives needed for the ray equations can be obtained by implicit differentiation </p><p class="formulaDsp">
\begin{equation}\frac{\partial D}{\partial\vec{x}}=\frac{\partial D}{\partial\omega}\frac{\partial\omega}{\partial\vec{x}}\Rightarrow\frac{\partial\omega}{\partial\vec{x}}=-\frac{\frac{\partial D}{\partial\vec{x}}}{\frac{\partial D}{\partial\omega}}\end{equation}
</p>
 <p class="formulaDsp">
\begin{equation}\frac{\partial D}{\partial\vec{k}}=\frac{\partial D}{\partial\omega}\frac{\partial\omega}{\partial\vec{k}}\Rightarrow\frac{\partial\omega}{\partial\vec{k}}=-\frac{\frac{\partial D}{\partial\vec{k}}}{\frac{\partial D}{\partial\omega}}\end{equation}
</p>
<p> These equations are integrated to trace the ray.</p>
<p>A ray tracing problem is build by implementing expressions for the plasma equilibrium. From the plasma equilibrium a dispersion relation is constructed. Equations of motion are defined using the auto differentiation. Expressions for ray update are built for in integrator. These expressions are JIT compiled into a single kernel call with inputs for \(\vec{x}\), \(\vec{k}\), \(t\), and \(\omega\) with outputs for the dispersion residual, and step updates for \(\vec{x}\), \(\vec{k}\) and \(t\).</p>
<div class="image">
<img src="TokamakRays.png" alt=""/>
<div class="caption">
100000 O-Mode rays traced in a realistic tokamak geometry.</div></div>
 <div class="image">
<img src="StellaratorRays.png" alt=""/>
<div class="caption">
10000 ray trajectories for a stellarator equilibrium using the same dispersion, and integrator method.</div></div>
<h3><a class="anchor" id="use_cases_rf_correctness"></a>
Correctness</h3>
<p>Here we illustrate the correctness of the code by examining waves described by relatively simple dispersion relations in plane stratified plasmas, that is plasma with spatial variation only in the \(x\) direction. In a spatially varying medium, at a given frequency, there may be regions in which the solution of the dispersion relation, $\vec{k}$, is real, and the wave propagates. In other regions \(\vec{k}\) is imaginary and the wave does not propagate, referred to as evanescent. The boundary between a region of propagation and evanescence is a surface called a cut-off. It is also possible that surfaces occur where \(\vec{k}\) diverges to infinity, in which case the phase velocity component normal to the surface goes to zero. These are called resonances. Typically, the wave is reflected at a cut-off and is absorbed or converted to a different type of wave at a resonance. These critical surfaces, therefore, demark important changes in wave behavior, and the behavior of rays in their vicinity is an indication of the correctness of the solution.</p>
<p>For plasma, the spatial dependence of the dispersion relation comes through variation of the plasma equilibrium quantities. These include the vector magnetic field, \(\vec{B}\left(x\right)\), the density of each plasma particle species, \(n_{s}\left(x\right)\), and the temperature of each particle species, \(T_{s}\left(x\right)\), where $s$ indicates a particular species. For the cases presented here a linear gradient along the \(x\) direction is taken for either the particle density or magnetic field strength. </p><p class="formulaDsp">
\begin{equation}f\left(x\right)=0.1x+1\end{equation}
</p>
<p> Unless otherwise noted, the following table lists values for the plasma conditions. </p><a class="anchor" id="plasma_condition"></a>
<table class="doxtable">
<caption>Plasma Parameters</caption>
<tr>
<th>Symbol </th><th>Value </th></tr>
<tr>
<td>\(m_{i}\) </td><td>\(3.344\times10^{-27}\) kg </td></tr>
<tr>
<td>\(n_{e0}\) </td><td>\(1\times10^{19}\) m \(^{-3}\) </td></tr>
<tr>
<td>\(n_{i0}\) </td><td>\(n_{e0}\) </td></tr>
<tr>
<td>\(T_{e}\) </td><td>\(1\) keV </td></tr>
<tr>
<td>\(T_{i}\) </td><td>\(T_{e}\) </td></tr>
<tr>
<td>\(\vec{B}\) </td><td>\(1\) T \(\hat{z}\) </td></tr>
</table>
<p>The examples presented employ the <a class="el" href="dispersion_function.html#dispersion_function_cold_plasma">Cold Plasma</a> approximation. This means that the particle thermal speeds are much less than the wave phase velocity and the magnetic field is sufficiently strong that the particle gyro-radius is much less than the wavelength. The cold-plasma approximation greatly simplifies the dispersion relation and is actually valid for a wide range of wave propagation situations of fusion interest. A further approximation is made that the wave frequency is so high that only the electrons respond to the wave fields and the much heavier ions do not contribute to the wave-induced plasma current.</p>
<p>Initial conditions for the wave solution are obtained by choosing fixed values for \(\omega\), \(\vec{x}\), \(k_{y}\), and \(k_{z}\). The remaining value \(k_{x}\) is solved for using a Newton method to a tolerance of \(\left|D\left(\vec{k},\omega\right)\right|&lt;10^{-15}\). Since the dispersion functions are multi-valued, an initial guess for \(k_{x}\) selects among the possible roots.</p>
<p>To mitigate the effects of floating point round-off errors, terms in the dispersion relation are combined to reduce the orders of magnitude for quantities. In plasmas, frequencies and waves typically trend in the \(100\) GHz range. Folding the speed of light into the frequency, \(\omega&#39;=\frac{\omega}{c}\), results in quantities of \(\omega&#39;\) on the order of \(1000\). The consequence is that this modified frequency \(\omega&#39;\) has units of m \(^{-1}\). The phase, \(v_{p}=\frac{\omega}{k}\), and group, \(v_{g}=\frac{\partial\omega}{\partial k}\), velocities are unit less. As a consequence, time now contains a speed of light term \(t&#39;=tc\) with units of m. This slows time from values on the order of \(1\times10^{-7}\) to \(1\). Under this scheme, quantities of interest for ray tracing, position, \(\vec{x}\), and wave number, \(\vec{k}\), retain their normal units. The <a class="el" href="dispersion_function.html#dispersion_function_normal">Normalization</a> table, summarizes the changes resulting from these modified units. The following results are converted back to real units unless otherwise indicated. </p><div class="image">
<img src="ColdPlasma.png" alt=""/>
<div class="caption">
The O-Mode branch can propagate through the quiescent region between the right-hand cutoff, ωr, and the upper hybrid resonance, ωh, that the X-Mode branch cannot but is cut off at the plasma frequency, ωpe. The X-Mode branch can pass the O-Mode's plasma cutoff but is stopped by the left-hand cutoff, ωl.</div></div>
<p> The figure above shows the dispersion relation for a uniform magnetic field and density gradient. This dispersion is a superposition of the <a class="el" href="dispersion_function.html#dispersion_function_o_wave">Ordinary Wave</a> and <a class="el" href="dispersion_function.html#dispersion_function_x_wave">Extra Ordinary Wave</a> dispersion relations. For a given frequency, one branch can cross cutoffs and resonances, the other cannot. </p><div class="image">
<img src="Cold-Plasma-Result.png" alt=""/>
<div class="caption">
Wave trajectory with frequencies above the right-hand cutoff, ωr, for the cold plasma dispersion relation. The O-Mode branch can pass the right-hand cutoff, ωr, and the upper hybrid resonance, ωh, while X-mode cannot. The bottom plot tracks the resulting dispersion function residual, |D(k,ω)|, of the solver as the rays are traced.</div></div>
<p> The figure above shows the wave trajectories for two waves above \(\omega_{r}\). The O-Mode branch can pass \(\omega_{r}\) while the X-Mode branch is reflected. </p><div class="image">
<img src="Cold-Plasma-Result2.png" alt=""/>
<div class="caption">
Wave trajectory with frequencies between the upper hybrid resonance, ωh, and the left-hand cutoff, ωl, for the cold plasma dispersion relation. The X-Mode branch can pass the plasma frequency cutoff, ωpe, while O-mode cannot. The O-Mode can pass through the upper hybrid resonance, ωh, while the X-Mode branch is absorbed. The bottom plot tracks the resulting dispersion function residual, |D(k,ω)|, of the solver as the rays are traced.</div></div>
<p> The figure above shows the wave trajectories for two waves between \(\omega_{h}\) and \(\omega_{l}\). The X-Mode branch can pass \(\omega_{pe}\) cutoff while the O-Mode branch is reflected. The X-Mode branch is absorbed in the upper hybrid resonance, \(\omega_{h}\), while the O-Mode branch can pass through it.</p>
<h3><a class="anchor" id="use_cases_rf_correctness"></a>
Correctness</h3>
<p><a href="https://compxco.com/genray.html">Genray</a> is an RF-Ray tracing code written in Fortran which operates in a cylindrical geometry. Toroidal equilibria can be imported using the <a href="https://dx.doi.org/10.1088/0029-5515/25/11/007">EFIT</a> EQDSK format. Derivative information must either be explicitly defined or used a numerical differentiation. Since Genray does not trace within the vacuum region care was taken to ensure the two codes started from the same initial conditions. A single ray was traced in Genray then initial position and wave number was used to initialize the Graph framework ray tracer. Additionally the plasma profiles from Genray were matched with expression in the graph framework. </p><div class="image">
<img src="GenrayRays.png" alt=""/>
<div class="caption">
Comparison of ray trajectory using the graph framework vs. the Genray code. Both codes show the same ray trajectory. The graph framework can continue to trace the rays in the vacuum region beyond the last closed flux surface.</div></div>
<p> The figure above shows the trajectory of rays in the a tokamak cross-section. Both codes show a nearly identical trajectory with only a slight deviation towards the end of ray. </p><div class="image">
<img src="GenrayComponents.png" alt=""/>
<div class="caption">
Comparison of x and k along the wave from Genray and the graph framework. Both codes show the same evolution of ray position and wave number as the ray is traced.</div></div>
<p> The figure above shows the comparison of wave position \(\vec{x}\) and wave number \(\vec{k}\). Since the two codes use different time steps, these are plotted with respect to the flux label \(\psi\). Both codes show nearly identical results with only a small deviation towards the end of the trace.</p>
<h1><a class="anchor" id="use_cases_particle_pushing"></a>
Particle Pushing</h1>
<p>In order to achieve good statistics for the evolution of particle distributions, it's necessary to push large numbers of particles. Exploiting GPU resources is necessary to achieve the large number of particles at reasonable run times to enable self consistent fields. An example is the runaway electron problem.</p>
<p>During a disruption in a tokamak, electric fields can drive electron beams up to relativistic speeds. These high energy particles can lose confinement and damage first wall components. The <a href="https://dx.doi.org/10.1088/1367-2630/12/12/123005">Boris</a> leap-frog algorithm can integrate particles while conserving energy and momentum. The algorithm updates particle position \(\vec{x}\), momentum \(\vec{u}\), and relativistic \(\gamma\). </p><div class="image">
<img src="ParticleTraces.png" alt=""/>
<div class="caption">
Particle trajectories in a realistic tokamak geometry.</div></div>
<p> The Figure above shows \(100\) out of \(10^{5}\) particles trajectories in a realistic tokamak geometry. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
